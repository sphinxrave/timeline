var gt=Object.defineProperty;var xt=(l,f,m)=>f in l?gt(l,f,{enumerable:!0,configurable:!0,writable:!0,value:m}):l[f]=m;var C=(l,f,m)=>(xt(l,typeof f!="symbol"?f+"":f,m),m),X=(l,f,m)=>{if(!f.has(l))throw TypeError("Cannot "+m)};var g=(l,f,m)=>(X(l,f,"read from private field"),m?m.call(l):f.get(l)),j=(l,f,m)=>{if(f.has(l))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(l):f.set(l,m)},y=(l,f,m,L)=>(X(l,f,"write to private field"),L?L.call(l,m):f.set(l,m),m);var $timeline=function(){var O,k,b,P,W;"use strict";const l=[1,1.5,2,2.5,3,5,8,12];function f(i){return{all:i=i||new Map,on:function(t,e){var n=i.get(t);n?n.push(e):i.set(t,[e])},off:function(t,e){var n=i.get(t);n&&(e?n.splice(n.indexOf(e)>>>0,1):i.set(t,[]))},emit:function(t,e){var n=i.get(t);n&&n.slice().map(function(a){a(e)}),(n=i.get("*"))&&n.slice().map(function(a){a(t,e)})}}}var m=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},L="Expected a function",A=0/0,G="[object Symbol]",Y=/^\s+|\s+$/g,q=/^[-+]0x[0-9a-f]+$/i,J=/^0b[01]+$/i,K=/^0o[0-7]+$/i,Q=parseInt,V=typeof m=="object"&&m&&m.Object===Object&&m,tt=typeof self=="object"&&self&&self.Object===Object&&self,et=V||tt||Function("return this")(),it=Object.prototype,nt=it.toString,at=Math.max,st=Math.min,B=function(){return et.Date.now()};function rt(i,t,e){var n,a,c,r,s,x,o=0,u=!1,T=!1,S=!0;if(typeof i!="function")throw new TypeError(L);t=R(t)||0,Z(e)&&(u=!!e.leading,T="maxWait"in e,c=T?at(R(e.maxWait)||0,t):c,S="trailing"in e?!!e.trailing:S);function p(v){var I=n,_=a;return n=a=void 0,o=v,r=i.apply(_,I),r}function w(v){return o=v,s=setTimeout($,t),u?p(v):r}function h(v){var I=v-x,_=v-o,U=t-I;return T?st(U,c-_):U}function d(v){var I=v-x,_=v-o;return x===void 0||I>=t||I<0||T&&_>=c}function $(){var v=B();if(d(v))return E(v);s=setTimeout($,h(v))}function E(v){return s=void 0,S&&n?p(v):(n=a=void 0,r)}function M(){s!==void 0&&clearTimeout(s),o=0,n=x=a=s=void 0}function H(){return s===void 0?r:E(B())}function z(){var v=B(),I=d(v);if(n=arguments,a=this,x=v,I){if(s===void 0)return w(x);if(T)return s=setTimeout($,t),p(x)}return s===void 0&&(s=setTimeout($,t)),r}return z.cancel=M,z.flush=H,z}function ot(i,t,e){var n=!0,a=!0;if(typeof i!="function")throw new TypeError(L);return Z(e)&&(n="leading"in e?!!e.leading:n,a="trailing"in e?!!e.trailing:a),rt(i,t,{leading:n,maxWait:t,trailing:a})}function Z(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function ht(i){return!!i&&typeof i=="object"}function ct(i){return typeof i=="symbol"||ht(i)&&nt.call(i)==G}function R(i){if(typeof i=="number")return i;if(ct(i))return A;if(Z(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=Z(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(Y,"");var e=J.test(i);return e||K.test(i)?Q(i.slice(2),e?2:8):q.test(i)?A:+i}var F=ot;function lt({pointWidth:i,timeSpacing:t,scaleSpacing:e,scaleHeight:n,startTime:a,endTime:c,drawLine:r,drawText:s}){const x=t/e;let o,u;switch(t){case 1:o=1,u=10;break;case 1.5:o=1,u=10;break;case 2:o=1,u=10;break;case 2.5:o=2,u=20;break;case 3:o=2,u=20;break;case 5:o=5,u=50;break;case 8:o=8,u=40;break;case 12:o=10,u=100;break;default:throw new Error(`Unsupported zoom level: ${t}`)}let T=a*10,S=c*10;for(let p=Math.floor(T/o)*o;p<=Math.ceil(S);p+=o){const w=p%u===0?n.height5:p%(u/2)===0?n.height3:n.height1,h=(p/10-a)/x-i/2;if(r(h,w),w===n.height5){const d=N(p/10);s(h,n.height6,d)}}}function N(i){const t=Math.floor(i/60/60),e=Math.floor(Math.abs(i)/60),n=Math.floor(Math.abs(i)%60);return`${t?t.toString().padStart(2,"0")+":":""}${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}var ft=mt;function D(i,t){return i===t?0:i<t?-1:1}function mt(i,t,e){e||(e=D);var n=ut(i,t,e);if(n===-1)return-1;for(;n<i.length;n++){var a=e(i[n],t);if(a>=0)return n}return-1}function ut(i,t,e){e||(e=D);for(var n=i.length,a=n-1,c=0,r=-1;a>=c&&c>=0&&a<n;){r=Math.floor((a+c)/2);var s=e(i[r],t);if(s===0)return r;s>=0?a=r-1:c=r+1}return r}const dt={fill:!1,bgColor:"rgba(0,0,0,0.5)",textColor:"#ffffff",scaleColor:"#ffffff",areaBgColor:"#ffffff55",pointColor:"#00aeec",pointWidth:3,scaleSpacing:7,fps:120,zoom:2,maxZoom:7,minZoom:1};class vt{constructor(t,e){C(this,"$canvas");C(this,"canvasContext");j(this,O,void 0);C(this,"currentTime");C(this,"areas");C(this,"waveform");j(this,k,void 0);j(this,b,void 0);C(this,"scaleSpacing");C(this,"bgColor");j(this,P,void 0);C(this,"pointWidth");C(this,"pointColor");C(this,"textColor");C(this,"scaleColor");C(this,"areaBgColor");j(this,W,void 0);C(this,"fps");C(this,"startTime");C(this,"endTime");if(!t)throw new Error("canvas id is required!");typeof t=="string"?this.$canvas=document.getElementById(t):this.$canvas=t,this.canvasContext=this.$canvas.getContext("2d");const{fill:n,width:a,height:c,bgColor:r,textColor:s,scaleColor:x,areaBgColor:o,pointColor:u,pointWidth:T,scaleSpacing:S,fps:p,zoom:w,maxZoom:h,minZoom:d}={...dt,...e};if(w<d||w>h||w%1!==0)throw new Error(`zoom must be minZoom ~ maxZoom(${d} ~1 ${h}), and must be an integer`);if(h<1||h>9||h%1!==0)throw new Error("maxZoom must be 1 ~ 9, and must be an integer");if(d<1||d>9||d%1!==0)throw new Error("minZoom must be 1 ~ 9, and must be an integer");if(h<d)throw new Error("maxZoom must be greater than minZoom");if(n){const M=this.$canvas.parentElement;this.$canvas.width=M.clientWidth,this.$canvas.height=M.clientHeight,new ResizeObserver(F(this._onParentResize.bind(this),200)).observe(M)}else a&&(this.$canvas.width=a),c&&(this.$canvas.height=c);y(this,W,!1),y(this,O,f()),this.currentTime=0,y(this,k,[]);for(let M=d-1;M<h;M++)g(this,k).push(l[M]);y(this,b,l[w-1]),this.scaleSpacing=S,y(this,P,{height6:this.$canvas.height/2,height5:this.$canvas.height/3,height4:this.$canvas.height/4,height3:this.$canvas.height/5,height2:this.$canvas.height/8+1,height1:this.$canvas.height/10+1}),this.bgColor=r,this.pointWidth=T,this.pointColor=u,this.textColor=s,this.scaleColor=x,this.areaBgColor=o,this.fps=p;const E=Math.ceil(this.$canvas.width/this.scaleSpacing)*g(this,b);this.startTime=this.currentTime-E/2,this.endTime=this.currentTime+E/2}draw({currentTime:t,areas:e,waveform:n,_privateFlag:a}){if(g(this,W)&&!a){console.log("dragging so failing");return}this.currentTime=t,this.areas=e||[],this.waveform=n||[];const c=this.$canvas.width/this.scaleSpacing,r=c*g(this,b),s=this.currentTime-r/2,x=this.currentTime+r/2,o=this.$canvas.width/2,u=r/this.$canvas.width;a&&this.emit("drag",[s,x]),this.clear(),this.drawArea(0,0,this.$canvas.width,this.$canvas.height,this.bgColor),this.areas.forEach(h=>{const d=h.startTime<s?0:Math.floor((h.startTime-s)/u),$=h.endTime>x?this.$canvas.width:Math.floor((h.endTime-s)/u);this.drawArea(d,0,$,this.$canvas.height,h.bgColor||this.areaBgColor)}),this.canvasContext.beginPath(),this.canvasContext.lineCap="round";let T=0,S=0,p=Math.max(1,Math.min(Math.floor(g(this,b)/3),10)),w=ft(this.waveform,[s-1,0],(h,d)=>{const $=h[0]-d[0];return $<0?-1:$>0?1:0});w===-1&&(w=this.waveform.length);for(let h=w;h<this.waveform.length;h++){const d=this.waveform[h];if(d[0]>x+1)break;if(S+=1,T+=d[1],S==p){const $=(d[0]-s+.025)/u,E=(this.$canvas.height-(this.$canvas.height-10)*(T/S/100))/2;this.canvasContext.moveTo($,E),this.canvasContext.lineTo($,this.$canvas.height-E),T=0,S=0}}return this.canvasContext.strokeStyle=this.areaBgColor,this.canvasContext.lineWidth=Math.max(1,.05/u*p),this.canvasContext.stroke(),lt.bind(this)({pointWidth:this.pointWidth,timePerPixel:u,scaleHeight:g(this,P),scaleSpacing:this.scaleSpacing,timeSpacing:g(this,b),screenScaleCount:c,startTime:s,endTime:x,drawLine:this.drawLine.bind(this),drawText:this.drawText.bind(this)}),this.drawTimelineScale(g(this,b)),this.drawLine(o-this.pointWidth/2,this.$canvas.height,this.pointWidth,this.pointColor),this.drawArea(o-54,4,o+54,18,this.pointColor),this.drawText(o,6,N(this.currentTime),this.textColor,"center","top"),this.$canvas.onwheel=this._onZoom.bind(this),this.$canvas.onmousedown=this._onDrag.bind(this),{startTime:s,endTime:x}}_onDrag({clientX:t}){y(this,W,!0);let e=0;const n=F(c=>{const r=c.clientX-t,s=Math.max(.01,this.currentTime-g(this,b)/this.scaleSpacing*(r-e));e=r,this.draw({currentTime:s,areas:this.areas,waveform:this.waveform,_privateFlag:!0})},g(this,b)===1?100:1e3/this.fps),a=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a),y(this,W,!1),this.emit("timeUpdate",[this.currentTime])};document.addEventListener("mousemove",n),document.addEventListener("mouseup",a)}_onZoom(t){t.preventDefault();const e=g(this,k).findIndex(n=>n===g(this,b));t.deltaY<0&&e>0?(y(this,b,g(this,k)[e-1]),this.draw({currentTime:this.currentTime,areas:this.areas,waveform:this.waveform,_privateFlag:!0})):t.deltaY>0&&e<g(this,k).length-1&&(y(this,b,g(this,k)[e+1]),this.draw({currentTime:this.currentTime,areas:this.areas,waveform:this.waveform,_privateFlag:!0}))}_onParentResize(){const t=this.$canvas.parentNode;!t||(this.$canvas.width=t.clientWidth,this.$canvas.height=t.clientHeight,y(this,P,{height6:this.$canvas.height/2,height5:this.$canvas.height/3,height4:this.$canvas.height/4,height3:this.$canvas.height/5,height2:this.$canvas.height/8,height1:this.$canvas.height/10}),this.draw({currentTime:this.currentTime,areas:this.areas,waveform:this.waveform}))}clear(){this.canvasContext&&this.canvasContext.clearRect(0,0,this.$canvas.width,this.$canvas.height),this.$canvas&&(this.$canvas.onwheel=null,this.$canvas.onmousedown=null)}drawTimelineScale(t){let e=t<60?`${t}s`:`${t/60}min`;this.drawText(this.scaleSpacing+12,9,`${e}`,this.textColor,"left","middle"),this.canvasContext.beginPath(),this.canvasContext.moveTo(5,6),this.canvasContext.lineTo(5,10),this.canvasContext.lineTo(this.scaleSpacing+7,10),this.canvasContext.lineTo(this.scaleSpacing+7,6),this.canvasContext.strokeStyle=this.scaleColor,this.canvasContext.lineWidth=1.5,this.canvasContext.stroke()}drawLine(t,e,n=1,a=this.scaleColor){this.canvasContext.beginPath(),this.canvasContext.moveTo(t,this.$canvas.height),this.canvasContext.lineTo(t,this.$canvas.height-e),this.canvasContext.strokeStyle=a,this.canvasContext.lineWidth=n,this.canvasContext.stroke()}drawText(t,e,n,a=this.textColor,c="center",r="alphabetic"){this.canvasContext.beginPath(),this.canvasContext.font="11px Franklin gothic medium",this.canvasContext.fillStyle=a,this.canvasContext.textAlign=c,this.canvasContext.textBaseline=r,this.canvasContext.fillText(n,t,e)}drawArea(t,e,n,a,c){this.canvasContext.beginPath(),this.canvasContext.rect(t,e,n-t,a-e),this.canvasContext.fillStyle=c,this.canvasContext.fill()}on(t,e){g(this,O).on(t,e)}off(t,e){g(this,O).off(t,e)}emit(...t){g(this,O).emit(...t)}}return O=new WeakMap,k=new WeakMap,b=new WeakMap,P=new WeakMap,W=new WeakMap,vt}();
